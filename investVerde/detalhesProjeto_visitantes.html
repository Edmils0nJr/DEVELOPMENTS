<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detalhes do Projeto</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="css/estilo.css" rel="stylesheet"/>
  <!-- Ícones Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    .avatar {
      width: 72px; height: 72px; border-radius: 50%; object-fit: cover; border: 2px solid #e9ecef;
    }
    .placeholder-box {
      background: repeating-linear-gradient(45deg,#f1f3f5,#f1f3f5 10px,#e9ecef 10px,#e9ecef 20px);
      border: 1px dashed #cfd4da; border-radius: .75rem;
    }

    /* CSS (adicione ao seu estilo global ou dentro da <style>) */
    .invest-btn-wrapper {
      display: flex;
      justify-content: center;
      margin-top: 1rem;
    }
    
    /* Botão principal */
    .btn-interest {
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 999px;
      font-weight: 600;
      box-shadow: 0 6px 18px rgba(255, 45, 85, 0.18);
      cursor: pointer;
      transition: transform 120ms ease, box-shadow 120ms ease, opacity 120ms ease;
      font-size: 0.95rem;
    }
    
    /* Ícone de coração */
    .btn-interest .heart-icon {
      font-size: 1.15rem;
      line-height: 1;
      display: inline-block;
      transform-origin: center;
      /* pulso suave */
      transition: transform 160ms ease;
    }
    
    /* Hover / foco */
    .btn-interest:hover,
    .btn-interest:focus {
      transform: translateY(-3px);
      box-shadow: 0 10px 24px rgba(255, 45, 85, 0.22);
      text-decoration: none;
      outline: none;
    }
    
    .btn-interest:active {
      transform: translateY(-1px) scale(0.995);
    }
    
    /* Pequena animação de 'batida' quando focado por teclado (acessibilidade) */
    .btn-interest:focus .heart-icon {
      animation: heartbeat 700ms ease;
    }
    
    /* Responsivo - reduz texto em telas pequenas */
    @media (max-width: 420px) {
      .btn-interest { padding: 0.5rem; border-radius: 12px; }
    }
    
    /* Keyframes para batimento */
    @keyframes heartbeat {
      0% { transform: scale(1); }
      30% { transform: scale(1.18); }
      50% { transform: scale(0.95); }
      70% { transform: scale(1.08); }
      100% { transform: scale(1); }
    }

    /* Ícone de coração */
    .btn-interest .heart-icon {
      font-size: 1.15rem;
      line-height: 1;
      display: inline-block;
      transform-origin: center;
      /* pulso suave */
      transition: transform 160ms ease;
    }
    
    /* Hover / foco */
    .btn-interest:hover,
    .btn-interest:focus {
      transform: translateY(-3px);
      box-shadow: 0 10px 24px rgba(255, 45, 85, 0.22);
      text-decoration: none;
      outline: none;
    }
    
    .btn-interest:active {
      transform: translateY(-1px) scale(0.995);
    }
    
    /* Pequena animação de 'batida' quando focado por teclado (acessibilidade) */
    .btn-interest:focus .heart-icon {
      animation: heartbeat 700ms ease;
    }
    
    /* Responsivo - reduz texto em telas pequenas */
    @media (max-width: 420px) {
      .interest-text { display: none; }
      .btn-interest { padding: 0.5rem; border-radius: 12px; }
    }
    
    /* Keyframes para batimento */
    @keyframes heartbeat {
      0% { transform: scale(1); }
      30% { transform: scale(1.18); }
      50% { transform: scale(0.95); }
      70% { transform: scale(1.08); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-4 col-lg-8 col-md-10 col-sm-12 box">
    <div class="text-center mb-4">
      <img src="https://raw.githubusercontent.com/Edmils0nJr/DEVELOPMENTS/main/css/logo.png" alt="Logo" style="height: 50px;" />
    </div>

    <div id="conteudo"></div>

    <div class="text-center mt-4">
      <a href="catalogo_visitantes.html" class="btn btn-success">Voltar ao Catálogo</a>
    </div>
  </div>

  <script>
    function nivelToPercent(n) {
      return Math.round((n/5)*100); 
    }

    function nivelToLabel(n) { 
      return `Nível ${n}/5`;
    }

    async function carregarDetalhes() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id") || 5;

      try {
        const res = await fetch("https://9tn2xd-3001.csb.app/api/projetos/" + id);
        const projeto = await res.json();

        // Avatar do responsável
        const avatar = projeto.avatar

        // Capa do projeto (imagem principal)
        const capa = projeto.img_projeto;

        // Verificação e nível de segurança (flexível em formatos)
        const nivel = 5;
        const nivelPct = nivelToPercent(nivel);
        const nivelLabel = nivelToLabel(nivel);

        let progressClass = 'bg-success';

        // URLs de arquivos (aceita nomes alternativos)
        const urlPpt = projeto.apresentacao_pptx_url || projeto.pptx_url || projeto.apresentacao_url || projeto.slides_url || null;
        const urlXlsx = projeto.orcamento_planilha_url || projeto.orcamento_url || projeto.xlsx_url || projeto.planilha_url || null;
        const urlPdf = projeto.descricao_pdf_url || projeto.pdf_url || projeto.documento_url || null;

        document.getElementById("conteudo").innerHTML = `
          <div class="text-center mb-4">
            <h5 class="text-success">${projeto.nome_projeto}</h5>
            <p class="text-muted">${projeto.categoria ?? ''}</p>
          </div>

          <!-- Capa do Projeto -->
          <div class="card mb-3" id="capa-card">
            <div class="card-body">
              <img src="${capa}" class="img-fluid rounded" alt="Capa do projeto">
            </div>
          </div>

          <div class="card mb-3">
            <div class="card-body">
              <h6 class="card-title">Sobre o Projeto</h6>
              <p class="card-text">${projeto.resumo_descricao ?? ''}</p>
            </div>
          </div>

          <div class="card mb-3">
            <div class="card-body">
              <h6 class="card-title">Financiamento</h6>
              <p class="card-text">Valor do Projeto: <strong>${projeto.valor ?? '—'}</strong></p>
            </div>
          </div>

          <!-- Responsável pelo projeto -->
          <div class="card mb-3">
            <div class="card-body d-flex align-items-center gap-3">
              <img class="avatar" src="${avatar}" alt="Avatar do responsável">
              <div>
                <h6 class="card-title mb-1">Responsável</h6>
                <p class="card-text mb-1"><strong>${projeto.nome ?? '—'}</strong></p>
                <p class="card-text text-muted mb-0">${projeto.email ?? ''}${projeto.telefone ? '<br>'+projeto.telefone : ''}</p>
              </div>
            </div>
          </div>

          <!-- Confiabilidade / Verificação -->
          <div class="card mb-3">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="card-title mb-0">Confiabilidade do Projeto</h6>
                <span class="badge bg-success'">
                  <i class="bi bi-patch-check-fill me-1"></i>Verificado
                </span>
              </div>
              <div class="small text-muted mb-2">Nível de segurança: <strong>${nivelLabel}</strong></div>
              <div class="progress" role="progressbar" aria-label="Nível de segurança" aria-valuenow="${nivelPct}" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar ${progressClass}" style="width: ${nivelPct}%"></div>
              </div>
              <p class="mt-2 mb-0 text-muted small">A verificação confirma que os dados do responsável e documentos básicos foram revisados. O nível de segurança indica o grau de robustez documental/operacional informado pelo proponente.</p>
            </div>
          </div>

          <!-- Arquivos do Projeto -->
          <div class="card mb-3">
            <div class="card-body">
              <h6 class="card-title">Arquivos do Projeto</h6>
              <p class="text-muted small mb-3">Estes arquivos aparecerão aqui quando forem enviados.</p>
              <div class="row g-3">
                <!-- PPTX -->
                <div class="col-md-4">
                  <div class="border rounded p-3 h-100 d-flex flex-column">
                    <div class="d-flex align-items-center gap-2 mb-2">
                      <i class="bi bi-filetype-pptx fs-3"></i>
                      <div>
                        <strong>Apresentação</strong>
                        <div class="text-muted small">PowerPoint (.pptx)</div>
                      </div>
                    </div>
                    <div class="mt-auto">
                      <span class="badge bg-secondary">Em breve</span>
                      <div class="text-muted small mt-1">Ex.: apresentacao-projeto.pptx</div>
                    </div>
                  </div>
                </div>

                <!-- XLSX -->
                <div class="col-md-4">
                  <div class="border rounded p-3 h-100 d-flex flex-column">
                    <div class="d-flex align-items-center gap-2 mb-2">
                      <i class="bi bi-filetype-xlsx fs-3"></i>
                      <div>
                        <strong>Orçamento</strong>
                        <div class="text-muted small">Planilha (.xlsx)</div>
                      </div>
                    </div>
                    <div class="mt-auto">
                      <span class="badge bg-secondary">Em breve</span>
                      <div class="text-muted small mt-1">Ex.: orcamento.xlsx</div>
                    </div>
                  </div>
                </div>

                <!-- PDF -->
                <div class="col-md-4">
                  <div class="border rounded p-3 h-100 d-flex flex-column">
                    <div class="d-flex align-items-center gap-2 mb-2">
                      <i class="bi bi-file-earmark-pdf fs-3"></i>
                      <div>
                        <strong>Descrição</strong>
                        <div class="text-muted small">PDF (.pdf)</div>
                      </div>
                    </div>
                    <div class="mt-auto">
                      <span class="badge bg-secondary">Em breve</span>
                      <div class="text-muted small mt-1">Ex.: descricao.pdf</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card mb-3">
            <div class="card-body">
              <div class="invest-btn-wrapper">
                <button class="btn-interest btn btn-success" aria-label="Tenho interesse em investir">
                  <i class="bi bi-heart-fill heart-icon" aria-hidden="true"></i>
                  <span class="interest-text">Tenho interesse</span>
                </button>
              </div>
            </div>
          </div>
        `;
      } catch (err) {
        console.error(err);
        document.getElementById("conteudo").innerHTML = "<p class='text-danger'>Erro ao carregar detalhes do projeto.</p>";
      }
    }

    carregarDetalhes();
  </script>
</body>
</html>
