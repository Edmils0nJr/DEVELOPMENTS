<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cadastro de Projeto</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="css/estilo.css" rel="stylesheet" />
</head>
<body class="bg-light">
  <div class="container py-4 col-lg-8 col-md-10 col-sm-12 box">
    <div class="text-center mb-4">
      <img src="https://raw.githubusercontent.com/Edmils0nJr/DEVELOPMENTS/main/css/logo.png" alt="Logo" style="height: 50px;" />
    </div>

    <h4 class="text-success mb-4 text-center">Cadastro de Projeto Sustentável</h4>

    <form id="formProjeto">
      <div class="mb-3">
        <label class="form-label">Nome do Projeto</label>
        <input type="text" class="form-control" id="nomeProjeto" required />
      </div>

      <div class="mb-3">
        <label class="form-label">Categoria</label>
        <input type="text" class="form-control" id="categoria" required />
      </div>

      <div class="mb-3">
        <label class="form-label">Resumo e Descrição</label>
        <textarea class="form-control" id="resumo" rows="3" required></textarea>
      </div>

      <div class="mb-3">
        <label class="form-label">Valor do Projeto (R$)</label>
        <input type="number" class="form-control" id="valor" required />
      </div>

      <!-- CHECKBOX: IMPACTOS AMBIENTAIS -->
      <div class="mb-3">
        <label class="form-label">Impactos Ambientais</label>
        <small class="text-muted d-block mb-2">(selecione todos aplicáveis)</small>

        <div class="form-check"><input class="form-check-input" type="checkbox" value="Árvores Plantadas" id="impacto1" /> <label class="form-check-label" for="impacto1">Árvores Plantadas</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" value="Energia Limpa Gerada" id="impacto2" /> <label class="form-check-label" for="impacto2">Energia Limpa Gerada</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" value="CO₂ Reduzido" id="impacto3" /> <label class="form-check-label" for="impacto3">CO₂ Reduzido</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" value="Água Preservada" id="impacto4" /> <label class="form-check-label" for="impacto4">Água Preservada</label></div>
        <div class="form-check"><input class="form-check-input" type="checkbox" value="Solo Recuperado" id="impacto5" /> <label class="form-check-label" for="impacto5">Solo Recuperado</label></div>
      </div>

      <!-- CHECKBOX: ODS -->
      <div class="mb-3">
        <label class="form-label">ODS (Objetivos de Desenvolvimento Sustentável)</label>
        <small class="text-muted d-block mb-2">(selecione todos aplicáveis)</small>
        <div class="row">
          <div class="col-sm-6">
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 1" id="ods1" /> <label class="form-check-label" for="ods1">ODS 1 – Erradicação da Pobreza</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 2" id="ods2" /> <label class="form-check-label" for="ods2">ODS 2 – Fome Zero</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 3" id="ods3" /> <label class="form-check-label" for="ods3">ODS 3 – Saúde e Bem-Estar</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 4" id="ods4" /> <label class="form-check-label" for="ods4">ODS 4 – Educação de Qualidade</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 5" id="ods5" /> <label class="form-check-label" for="ods5">ODS 5 – Igualdade de Gênero</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 6" id="ods6" /> <label class="form-check-label" for="ods6">ODS 6 – Água Potável</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 7" id="ods7" /> <label class="form-check-label" for="ods7">ODS 7 – Energia Limpa</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 8" id="ods8" /> <label class="form-check-label" for="ods8">ODS 8 – Trabalho Decente</label></div>
          </div>
          <div class="col-sm-6">
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 9" id="ods9" /> <label class="form-check-label" for="ods9">ODS 9 – Inovação</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 10" id="ods10" /> <label class="form-check-label" for="ods10">ODS 10 – Redução das Desigualdades</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 11" id="ods11" /> <label class="form-check-label" for="ods11">ODS 11 – Cidades Sustentáveis</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 12" id="ods12" /> <label class="form-check-label" for="ods12">ODS 12 – Consumo Responsável</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 13" id="ods13" /> <label class="form-check-label" for="ods13">ODS 13 – Ação Climática</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 14" id="ods14" /> <label class="form-check-label" for="ods14">ODS 14 – Vida na Água</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 15" id="ods15" /> <label class="form-check-label" for="ods15">ODS 15 – Vida Terrestre</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 16" id="ods16" /> <label class="form-check-label" for="ods16">ODS 16 – Paz e Justiça</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" value="ODS 17" id="ods17" /> <label class="form-check-label" for="ods17">ODS 17 – Parcerias</label></div>
          </div>
        </div>
      </div>

      <button type="submit" class="btn btn-success w-100">Cadastrar Projeto</button>
    </form>
  </div>

  <script>
    document.getElementById("formProjeto").addEventListener("submit", async function (e) {
      e.preventDefault();

      const nome_projeto = document.getElementById("nomeProjeto").value;
      const categoria = document.getElementById("categoria").value;
      const resumo_descricao = document.getElementById("resumo").value;
      const valor = document.getElementById("valor").value;

      // Coleta impactos selecionados
      const impacto = Array.from(document.querySelectorAll('input[id^="impacto"]:checked')).map(cb => cb.value);

      // Coleta ODS selecionados
      const ods = Array.from(document.querySelectorAll('input[id^="ods"]:checked')).map(cb => cb.value);

      const usuario = JSON.parse(localStorage.getItem('usuario'));

      try {
        const resposta = await fetch("https://9tn2xd-3001.csb.app/api/projetos/cria", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            nome_projeto,
            categoria,
            resumo_descricao,
            valor,
            impacto,
            ods,
            usuario_id: usuario.id
          })
        });

        const dados = await resposta.json();

        if (!resposta.ok) throw new Error(dados.erro || "Erro ao cadastrar");

        alert("Projeto cadastrado com sucesso!");
        window.location.href = "catalogo_empreendedor.html";

      } catch (erro) {
        console.error("Erro:", erro);
        alert("Erro ao cadastrar projeto: " + erro.message);
      }
    });
  </script>
</body>
</html>
